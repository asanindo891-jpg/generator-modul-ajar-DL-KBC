<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generator Modul Ajar</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#fee2e2,#fed7aa);padding:20px}
.container{max-width:1200px;margin:0 auto}
.header{background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff;padding:30px;border-radius:15px;margin-bottom:20px;box-shadow:0 4px 20px rgba(0,0,0,.2)}
.header h1{font-size:2em;margin-bottom:10px}
.buttons{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:.95em;transition:transform .2s;text-decoration:none;display:inline-block}
.btn:hover{transform:translateY(-2px)}
.btn-gray{background:#6b7280;color:#fff}
.btn-green{background:#16a34a;color:#fff}
.btn-red{background:#dc2626;color:#fff}
.btn-blue{background:#2563eb;color:#fff}
.progress{background:#e5e7eb;height:8px;border-radius:10px;margin-bottom:20px}
.progress-bar{background:#dc2626;height:100%;transition:width .3s;border-radius:10px}
.content{background:#fff;border-radius:15px;padding:30px;box-shadow:0 4px 20px rgba(0,0,0,.1);min-height:400px}
.steps{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;margin-bottom:20px}
.step{padding:12px 8px;border-radius:8px;cursor:pointer;transition:all .3s;background:#f3f4f6;text-align:center;font-size:.85em;font-weight:600}
.step.active{background:#dc2626;color:#fff}
.form-group{margin-bottom:20px}
label{display:block;font-weight:600;margin-bottom:8px;color:#374151}
input,select,textarea{width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;font-size:1em;font-family:inherit}
input:focus,select:focus,textarea:focus{outline:0;border-color:#dc2626}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:15px}
.template-box{background:#dbeafe;border:2px solid #3b82f6;padding:20px;border-radius:12px;margin:20px 0}
.template-box h4{color:#1e40af;margin-bottom:15px}
.list-item{display:flex;gap:10px;margin-bottom:10px;align-items:start}
.btn-remove{background:#ef4444;color:#fff;padding:10px 15px;border:none;border-radius:8px;cursor:pointer;min-width:40px}
.btn-add{background:#fff;color:#dc2626;border:2px dashed #dc2626;padding:10px;border-radius:8px;cursor:pointer;width:100%;margin-top:10px;font-weight:600}
.nav-buttons{display:flex;justify-content:space-between;margin-top:30px;gap:10px}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000}
.modal-content{background:#fff;max-width:600px;margin:50px auto;padding:30px;border-radius:15px;max-height:80vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.close{font-size:2em;cursor:pointer;color:#6b7280;line-height:1}
.saved-item{border:2px solid #e5e7eb;padding:15px;border-radius:8px;margin-bottom:10px}
.saved-item h3{color:#dc2626;margin-bottom:5px}
@media(max-width:768px){.grid-2{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>üìù Generator Modul Ajar</h1>
<p>Kurikulum Merdeka - Template Ready</p>
<div id="autoSaveStatus" style="text-align:right;margin-top:10px;font-size:.9em"></div>
</div>
<div class="buttons">
<button class="btn btn-gray" onclick="showSaved()">üìÇ Tersimpan</button>
<button class="btn btn-green" onclick="saveModule()">üíæ Simpan</button>
<button class="btn btn-red" onclick="exportModule()">üì• Export</button>
</div>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>
<div class="steps" id="stepsContainer"></div>
<div class="content" id="contentArea"></div>
<div class="nav-buttons">
<button class="btn btn-gray" onclick="prevStep()" id="prevBtn">‚Üê Sebelumnya</button>
<button class="btn btn-red" onclick="nextStep()" id="nextBtn">Lanjut ‚Üí</button>
</div>
</div>
<div id="savedModal" class="modal">
<div class="modal-content">
<div class="modal-header"><h2>Modul Tersimpan</h2><span class="close" onclick="closeModal()">&times;</span></div>
<div id="savedList"></div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
let currentStep = 0;
const steps = [
{id:'identitas',title:'1. Identitas'},
{id:'cp',title:'2. CP'},
{id:'tujuan',title:'3. Tujuan'},
{id:'pemahaman',title:'4. Pemahaman'},
{id:'pemantik',title:'5. Pertanyaan'},
{id:'pendahuluan',title:'6. Pendahuluan'},
{id:'inti',title:'7. Inti'},
{id:'penutup',title:'8. Penutup'},
{id:'asesmen',title:'9. Asesmen'},
{id:'diferensiasi',title:'10. Diferensiasi'},
{id:'media',title:'11. Media'}
];

let formData = {
satuan:'',mataPelajaran:'',fase:'',kelas:'',semester:'',alokasi:'',tahunPelajaran:'',penyusun:'',
capaianPembelajaran:'',tujuanPembelajaran:[''],pemahamanBermakna:[''],pertanyaanPemantik:[''],
kegiatanPendahuluan:'',kegiatanInti:'',kegiatanPenutup:'',asesmenDiagnostik:'',asesmenFormatif:'',
asesmenSumatif:'',diferensiasiKonten:'',diferensiasiProses:'',diferensiasiProduk:'',
p5Dimensi:[],p5Keterkaitan:'',mediaSumber:['']
};

const TEMPLATES = {
'Bahasa Indonesia': {
'Teks Anekdot (X)': {
cp:'Peserta didik mampu memahami, menganalisis struktur dan kaidah kebahasaan, serta memproduksi teks anekdot.',
tujuan:['Menganalisis struktur teks anekdot','Mengevaluasi penggunaan majas','Menciptakan teks anekdot'],
pemahaman:['Teks anekdot menyampaikan kritik sosial dengan menghibur'],
pemantik:['Mengapa kritik lewat cerita lucu lebih efektif?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Mengamati contoh\nElaborasi: Analisis struktur\nKreasi: Menyusun teks',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tanya jawab pemahaman awal',
asesmenFormatif:'Penilaian diskusi',
asesmenSumatif:'Penilaian produk teks',
diferensiasiKonten:'Teks berbeda kompleksitas',
diferensiasiProses:'Individu atau berpasangan',
diferensiasiProduk:'Tertulis, komik, video',
p5Dimensi:['Bernalar kritis','Kreatif'],
p5Keterkaitan:'Mengembangkan kritik konstruktif',
mediaSumber:['Buku teks','Video','LKPD']
},
'Teks Eksposisi (X)': {
cp:'Peserta didik mampu menganalisis dan memproduksi teks eksposisi dengan argumentasi logis.',
tujuan:['Menganalisis struktur eksposisi','Mengevaluasi argumentasi','Menciptakan teks eksposisi'],
pemahaman:['Eksposisi menyampaikan informasi sistematis'],
pemantik:['Bagaimana membedakan fakta dan opini?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Membaca teks\nElaborasi: Analisis struktur\nKreasi: Menyusun eksposisi',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tanya jawab awal',
asesmenFormatif:'Penilaian draft',
asesmenSumatif:'Penilaian produk final',
diferensiasiKonten:'Teks berbeda kompleksitas',
diferensiasiProses:'Individu atau kelompok',
diferensiasiProduk:'Artikel, infografis, video',
p5Dimensi:['Bernalar kritis','Mandiri'],
p5Keterkaitan:'Berpikir kritis untuk kebaikan',
mediaSumber:['Buku teks','Artikel','LKPD']
}
},
'Matematika': {
'Trigonometri (X)': {
cp:'Peserta didik mampu memahami perbandingan trigonometri dan menerapkannya.',
tujuan:['Menganalisis hubungan sudut dan sisi','Mengevaluasi identitas trigonometri','Memecahkan masalah'],
pemahaman:['Trigonometri menghitung jarak dan sudut sulit diukur'],
pemantik:['Bagaimana arsitek tentukan kemiringan atap?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Segitiga siku-siku\nElaborasi: Diskusi\nKreasi: Proyek pengukuran',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tes konsep prasyarat',
asesmenFormatif:'Observasi diskusi',
asesmenSumatif:'Tes tertulis dan proyek',
diferensiasiKonten:'Soal bertingkat',
diferensiasiProses:'Scaffolding',
diferensiasiProduk:'Laporan atau video',
p5Dimensi:['Bernalar kritis','Kreatif'],
p5Keterkaitan:'Matematika untuk solusi',
mediaSumber:['Buku','GeoGebra','Video']
},
'Persamaan Kuadrat (IX)': {
cp:'Peserta didik mampu menyelesaikan persamaan kuadrat dengan berbagai metode.',
tujuan:['Menganalisis persamaan kuadrat','Mengevaluasi metode penyelesaian','Memecahkan masalah kontekstual'],
pemahaman:['Persamaan kuadrat ada dalam kehidupan sehari-hari'],
pemantik:['Bagaimana menghitung lintasan bola?'],
pendahuluan:'1. Salam dan doa\n2. Review materi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Grafik fungsi\nElaborasi: Metode penyelesaian\nKreasi: Proyek masalah',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Kuis prasyarat',
asesmenFormatif:'Latihan soal',
asesmenSumatif:'Tes tertulis',
diferensiasiKonten:'Soal sederhana hingga kompleks',
diferensiasiProses:'Panduan bertahap',
diferensiasiProduk:'Tertulis atau presentasi',
p5Dimensi:['Bernalar kritis','Mandiri'],
p5Keterkaitan:'Pemecahan masalah sistematis',
mediaSumber:['Buku','GeoGebra','Kalkulator']
}
},
'IPA': {
'Sistem Pencernaan (VIII)': {
cp:'Peserta didik mampu menganalisis sistem pencernaan dan menerapkan pola hidup sehat.',
tujuan:['Menganalisis organ pencernaan','Mengevaluasi pola makan','Merancang program sehat'],
pemahaman:['Sistem pencernaan sehat untuk nutrisi optimal'],
pemantik:['Mengapa mengunyah penting?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Torso sistem pencernaan\nElaborasi: Diskusi proses\nKreasi: Poster pola makan',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tanya jawab awal',
asesmenFormatif:'Observasi diskusi',
asesmenSumatif:'Tes dan presentasi',
diferensiasiKonten:'Video berbeda kompleksitas',
diferensiasiProses:'Kelompok atau individu',
diferensiasiProduk:'Poster, infografis, video',
p5Dimensi:['Beriman bertakwa','Mandiri'],
p5Keterkaitan:'Menjaga kesehatan sebagai amanah',
mediaSumber:['Buku IPA','Torso','Video']
},
'Cahaya dan Optik (VIII)': {
cp:'Peserta didik mampu memahami sifat cahaya dan penerapannya.',
tujuan:['Menganalisis sifat cahaya','Mengevaluasi alat optik','Merancang percobaan'],
pemahaman:['Cahaya memiliki sifat yang bermanfaat'],
pemantik:['Mengapa ada pelangi?'],
pendahuluan:'1. Salam dan doa\n2. Demonstrasi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Percobaan cahaya\nElaborasi: Diskusi pemantulan\nKreasi: Membuat periskop',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tanya jawab pengalaman',
asesmenFormatif:'Observasi praktikum',
asesmenSumatif:'Laporan praktikum',
diferensiasiKonten:'Percobaan berbeda kesulitan',
diferensiasiProses:'Panduan detail',
diferensiasiProduk:'Laporan atau video',
p5Dimensi:['Bernalar kritis','Kreatif'],
p5Keterkaitan:'Memahami ciptaan Tuhan',
mediaSumber:['Buku IPA','Alat praktikum','Video']
}
},
'IPS': {
'Letak Geografis Indonesia (VII)': {
cp:'Peserta didik mampu menganalisis letak geografis Indonesia dan pengaruhnya.',
tujuan:['Menganalisis letak geografis','Mengevaluasi keuntungan','Mengaitkan dengan kehidupan'],
pemahaman:['Letak geografis memberikan keuntungan strategis'],
pemantik:['Mengapa Indonesia negara maritim?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi peta\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Peta dan globe\nElaborasi: Diskusi keuntungan\nKreasi: Infografis',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tanya jawab pemahaman',
asesmenFormatif:'Observasi diskusi',
asesmenSumatif:'Tes dan proyek',
diferensiasiKonten:'Peta detail berbeda',
diferensiasiProses:'Individu atau kelompok',
diferensiasiProduk:'Infografis, peta konsep',
p5Dimensi:['Berkebinekaan global','Bernalar kritis'],
p5Keterkaitan:'Mensyukuri karunia geografis',
mediaSumber:['Buku IPS','Peta','Globe','Video']
},
'Interaksi Sosial (VII)': {
cp:'Peserta didik mampu memahami dan menganalisis interaksi sosial.',
tujuan:['Menganalisis bentuk interaksi','Mengevaluasi faktor','Mempraktikkan interaksi positif'],
pemahaman:['Interaksi sosial dasar kehidupan bermasyarakat'],
pemantik:['Mengapa manusia tidak bisa hidup sendiri?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Mengamati interaksi\nElaborasi: Diskusi\nKreasi: Roleplay',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tanya jawab pengalaman',
asesmenFormatif:'Observasi roleplay',
asesmenSumatif:'Laporan observasi',
diferensiasiKonten:'Kasus berbeda kompleksitas',
diferensiasiProses:'Diskusi kecil atau besar',
diferensiasiProduk:'Laporan, video, drama',
p5Dimensi:['Bergotong royong','Berkebinekaan global'],
p5Keterkaitan:'Interaksi positif untuk harmoni',
mediaSumber:['Buku IPS','Video','LKPD']
}
},
'Bahasa Inggris': {
'Descriptive Text (VII)': {
cp:'Students can understand, analyze, and produce descriptive texts.',
tujuan:['Analyzing structure','Evaluating adjectives','Creating descriptive text'],
pemahaman:['Descriptive text helps readers imagine clearly'],
pemantik:['How to describe someone we admire?'],
pendahuluan:'1. Greeting and prayer\n2. Warming up\n3. Objectives\n4. Motivation',
inti:'Exploration: Reading texts\nElaboration: Analyzing structure\nCreation: Writing text',
penutup:'1. Conclusion\n2. Reflection\n3. Assignment',
asesmenDiagnostik:'Oral questions',
asesmenFormatif:'Observation during discussion',
asesmenSumatif:'Written text with rubric',
diferensiasiKonten:'Texts with varying difficulty',
diferensiasiProses:'Individual or pair work',
diferensiasiProduk:'Written, poster, or video',
p5Dimensi:['Kreatif','Berkebinekaan global'],
p5Keterkaitan:'Appreciating diversity',
mediaSumber:['English textbook','Pictures','Videos']
},
'Recount Text (VIII)': {
cp:'Students can understand, analyze, and produce recount texts.',
tujuan:['Analyzing recount structure','Evaluating past tense','Creating personal recount'],
pemahaman:['Recount helps share experiences'],
pemantik:['What was your memorable experience?'],
pendahuluan:'1. Greeting\n2. Warming up\n3. Objectives\n4. Motivation',
inti:'Exploration: Reading recounts\nElaboration: Identifying structure\nCreation: Writing recount',
penutup:'1. Summary\n2. Reflection\n3. Homework',
asesmenDiagnostik:'Speaking about past activities',
asesmenFormatif:'Process writing observation',
asesmenSumatif:'Written recount assessment',
diferensiasiKonten:'Various text lengths',
diferensiasiProses:'Scaffolding support',
diferensiasiProduk:'Written, illustrated, digital',
p5Dimensi:['Kreatif','Mandiri'],
p5Keterkaitan:'Sharing valuable experiences',
mediaSumber:['English textbook','Sample texts']
}
},
'PJOK': {
'Permainan Bola Voli (VIII)': {
cp:'Peserta didik mampu mempraktikkan teknik dasar bola voli dan nilai sportivitas.',
tujuan:['Mempraktikkan passing','Mengevaluasi strategi','Mendemonstrasikan sportivitas'],
pemahaman:['Teknik benar tingkatkan performa'],
pemantik:['Mengapa voli 6 orang per tim?'],
pendahuluan:'1. Berbaris, doa\n2. Apersepsi\n3. Tujuan\n4. Pemanasan',
inti:'Eksplorasi: Demonstrasi teknik\nElaborasi: Latihan passing\nKreasi: Permainan',
penutup:'1. Pendinginan\n2. Refleksi\n3. Doa',
asesmenDiagnostik:'Observasi kemampuan awal',
asesmenFormatif:'Penilaian praktik',
asesmenSumatif:'Tes keterampilan',
diferensiasiKonten:'Modifikasi net dan lapangan',
diferensiasiProses:'Kelompok sesuai kemampuan',
diferensiasiProduk:'Praktik atau peran wasit',
p5Dimensi:['Bergotong royong','Mandiri'],
p5Keterkaitan:'Kerja sama dan sportivitas',
mediaSumber:['Buku PJOK','Bola voli','Net']
}
},
'PPKn': {
'Pancasila sebagai Dasar Negara (VII)': {
cp:'Peserta didik mampu memahami nilai Pancasila dan menganalisis penerapannya.',
tujuan:['Menganalisis makna sila','Mengevaluasi penerapan','Mengimplementasikan nilai'],
pemahaman:['Pancasila identitas dan pemersatu bangsa'],
pemantik:['Mengapa Pancasila penting?'],
pendahuluan:'1. Salam dan doa\n2. Menyanyikan lagu\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Mengkaji Pancasila\nElaborasi: Diskusi nilai\nKreasi: Poster',
penutup:'1. Kesimpulan\n2. Refleksi\n3. Penguatan',
asesmenDiagnostik:'Tanya jawab pemahaman',
asesmenFormatif:'Observasi diskusi',
asesmenSumatif:'Tes dan proyek',
diferensiasiKonten:'Kasus berbeda kompleksitas',
diferensiasiProses:'Diskusi klasikal atau kelompok',
diferensiasiProduk:'Poster, video, essay',
p5Dimensi:['Beriman bertakwa','Berkebinekaan global'],
p5Keterkaitan:'Mengamalkan Pancasila',
mediaSumber:['Buku PPKn','Lambang Pancasila','Video']
}
},
'Seni Budaya': {
'Menggambar Bentuk (VII)': {
cp:'Peserta didik mampu memahami prinsip menggambar bentuk dan menghasilkan karya.',
tujuan:['Menganalisis perspektif','Mengevaluasi komposisi','Menciptakan gambar bentuk'],
pemahaman:['Menggambar melatih observasi dan ketelitian'],
pemantik:['Bagaimana membuat gambar tiga dimensi?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Mengamati objek\nElaborasi: Teknik perspektif\nKreasi: Menggambar',
penutup:'1. Pameran karya\n2. Refleksi\n3. Apresiasi',
asesmenDiagnostik:'Observasi kemampuan awal',
asesmenFormatif:'Penilaian proses',
asesmenSumatif:'Penilaian karya final',
diferensiasiKonten:'Objek berbeda kesulitan',
diferensiasiProses:'Bantuan individual',
diferensiasiProduk:'Hitam putih atau berwarna',
p5Dimensi:['Kreatif','Mandiri'],
p5Keterkaitan:'Apresiasi keindahan ciptaan',
mediaSumber:['Buku Seni','Pensil','Kertas']
}
},
'Prakarya': {
'Kerajinan Tekstil (VII)': {
cp:'Peserta didik mampu merancang dan membuat produk kerajinan tekstil.',
tujuan:['Menganalisis bahan tekstil','Mengevaluasi desain','Menciptakan produk'],
pemahaman:['Kerajinan tekstil peluang usaha kreatif'],
pemantik:['Apa keunggulan kerajinan handmade?'],
pendahuluan:'1. Salam dan doa\n2. Apersepsi\n3. Tujuan\n4. Motivasi',
inti:'Eksplorasi: Mengamati produk\nElaborasi: Teknik dan desain\nKreasi: Membuat tas',
penutup:'1. Pameran produk\n2. Refleksi\n3. Apresiasi',
asesmenDiagnostik:'Observasi keterampilan',
asesmenFormatif:'Penilaian proses',
asesmenSumatif:'Penilaian produk final',
diferensiasiKonten:'Produk berbeda kesulitan',
diferensiasiProses:'Bantuan teknis',
diferensiasiProduk:'Berbagai pilihan produk',
p5Dimensi:['Kreatif','Mandiri'],
p5Keterkaitan:'Keterampilan untuk kemandirian',
mediaSumber:['Buku Prakarya','Kain','Jarum']
}
}
};

window.onload = function() {
loadFromLocalStorage();
renderSteps();
renderContent();
updateProgress();
};

function renderSteps() {
let html = '';
for(let i = 0; i < steps.length; i++) {
html += '<div class="step ' + (i === currentStep ? 'active' : '') + '" onclick="goToStep(' + i + ')">' + steps[i].title + '</div>';
}
document.getElementById('stepsContainer').innerHTML = html;
}

function showTemplateSelector() {
const m = formData.mataPelajaran;
if(!m) return '<div class="template-box"><p>‚ö†Ô∏è Isi Mata Pelajaran dulu</p></div>';
const t = TEMPLATES[m];
if(!t) return '<div class="template-box"><p>üìã Template dalam pengembangan</p></div>';
let html = '<div class="template-box"><h4>‚ö° Template Siap Pakai</h4><select id="topikTemplate"><option value="">-- Pilih --</option>';
for(let k in t) {
html += '<option value="' + k + '">' + k + '</option>';
}
html += '</select><br><br><button onclick="loadTemplate()" class="btn btn-blue" style="width:100%">‚ú® Muat Template</button></div>';
return html;
}

function loadTemplate() {
const m = formData.mataPelajaran;
const t = document.getElementById('topikTemplate').value;
if(!t) { alert('Pilih topik!'); return; }
const tp = TEMPLATES[m][t];
if(tp) {
formData.capaianPembelajaran = tp.cp;
formData.tujuanPembelajaran = tp.tujuan.slice();
formData.pemahamanBermakna = tp.pemahaman.slice();
formData.pertanyaanPemantik = tp.pemantik.slice();
formData.kegiatanPendahuluan = tp.pendahuluan;
formData.kegiatanInti = tp.inti;
formData.kegiatanPenutup = tp.penutup;
formData.asesmenDiagnostik = tp.asesmenDiagnostik;
formData.asesmenFormatif = tp.asesmenFormatif;
formData.asesmenSumatif = tp.asesmenSumatif;
formData.diferensiasiKonten = tp.diferensiasiKonten;
formData.diferensiasiProses = tp.diferensiasiProses;
formData.diferensiasiProduk = tp.diferensiasiProduk;
formData.p5Dimensi = tp.p5Dimensi.slice();
formData.p5Keterkaitan = tp.p5Keterkaitan;
formData.mediaSumber = tp.mediaSumber.slice();
renderContent();
alert('‚úÖ Template dimuat!');
}
}

function renderContent() {
const c = document.getElementById('contentArea');
const s = steps[currentStep];
if(s.id === 'identitas') {
c.innerHTML = '<h2>Identitas</h2>' + showTemplateSelector() +
'<div class="form-group"><label>Satuan</label><select onchange="updateField(\'satuan\',this.value)"><option value="">Pilih</option><option value="SD">SD</option><option value="SMP">SMP</option><option value="SMA">SMA</option></select></div>' +
'<div class="form-group"><label>Mata Pelajaran</label><input value="' + formData.mataPelajaran + '" onchange="updateField(\'mataPelajaran\',this.value);renderContent()"></div>' +
'<div class="grid-2"><div class="form-group"><label>Kelas</label><input value="' + formData.kelas + '" onchange="updateField(\'kelas\',this.value)"></div>' +
'<div class="form-group"><label>Semester</label><select onchange="updateField(\'semester\',this.value)"><option value="">Pilih</option><option value="1">1</option><option value="2">2</option></select></div></div>' +
'<div class="form-group"><label>Alokasi</label><input value="' + formData.alokasi + '" placeholder="2x45 menit" onchange="updateField(\'alokasi\',this.value)"></div>' +
'<div class="form-group"><label>Penyusun</label><input value="' + formData.penyusun + '" onchange="updateField(\'penyusun\',this.value)"></div>';
} else if(s.id === 'cp') {
c.innerHTML = '<h2>Capaian Pembelajaran</h2><textarea rows="8" onchange="updateField(\'capaianPembelajaran\',this.value)">' + formData.capaianPembelajaran + '</textarea>';
} else if(s.id === 'tujuan') {
let h = '<h2>Tujuan (HOTS)</h2>';
for(let i = 0; i < formData.tujuanPembelajaran.length; i++) {
h += '<div class="list-item"><textarea rows="2" onchange="updateListItem(\'tujuanPembelajaran\',' + i + ',this.value)">' + formData.tujuanPembelajaran[i] + '</textarea>';
if(formData.tujuanPembelajaran.length > 1) h += '<button class="btn-remove" onclick="removeListItem(\'tujuanPembelajaran\',' + i + ')">‚úï</button>';
h += '</div>';
}
h += '<button class="btn-add" onclick="addListItem(\'tujuanPembelajaran\')">+ Tambah</button>';
c.innerHTML = h;
} else if(s.id === 'pemahaman') {
let h = '<h2>Pemahaman Bermakna</h2>';
for(let i = 0; i < formData.pemahamanBermakna.length; i++) {
h += '<div class="list-item"><textarea rows="2" onchange="updateListItem(\'pemahamanBermakna\',' + i + ',this.value)">' + formData.pemahamanBermakna[i] + '</textarea>';
if(formData.pemahamanBermakna.length > 1) h += '<button class="btn-remove" onclick="removeListItem(\'pemahamanBermakna\',' + i + ')">‚úï</button>';
h += '</div>';
}
h += '<button class="btn-add" onclick="addListItem(\'pemahamanBermakna\')">+ Tambah</button>';
c.innerHTML = h;
} else if(s.id === 'pemantik') {
let h = '<h2>Pertanyaan Pemantik</h2>';
for(let i = 0; i < formData.pertanyaanPemantik.length; i++) {
h += '<div class="list-item"><input value="' + formData.pertanyaanPemantik[i] + '" onchange="updateListItem(\'pertanyaanPemantik\',' + i + ',this.value)">';
if(formData.pertanyaanPemantik.length > 1) h += '<button class="btn-remove" onclick="removeListItem(\'pertanyaanPemantik\',' + i + ')">‚úï</button>';
h += '</div>';
}
h += '<button class="btn-add" onclick="addListItem(\'pertanyaanPemantik\')">+ Tambah</button>';
c.innerHTML = h;
} else if(s.id === 'pendahuluan') {
c.innerHTML = '<h2>Kegiatan Pendahuluan</h2><textarea rows="8" onchange="updateField(\'kegiatanPendahuluan\',this.value)">' + formData.kegiatanPendahuluan + '</textarea>';
} else if(s.id === 'inti') {
c.innerHTML = '<h2>Kegiatan Inti</h2><textarea rows="10" onchange="updateField(\'kegiatanInti\',this.value)">' + formData.kegiatanInti + '</textarea>';
} else if(s.id === 'penutup') {
c.innerHTML = '<h2>Penutup</h2><textarea rows="8" onchange="updateField(\'kegiatanPenutup\',this.value)">' + formData.kegiatanPenutup + '</textarea>';
} else if(s.id === 'asesmen') {
c.innerHTML = '<h2>Asesmen</h2><div class="form-group"><label>Diagnostik</label><textarea rows="3" onchange="updateField(\'asesmenDiagnostik\',this.value)">' + formData.asesmenDiagnostik + '</textarea></div>' +
'<div class="form-group"><label>Formatif</label><textarea rows="3" onchange="updateField(\'asesmenFormatif\',this.value)">' + formData.asesmenFormatif + '</textarea></div>' +
'<div class="form-group"><label>Sumatif</label><textarea rows="3" onchange="updateField(\'asesmenSumatif\',this.value)">' + formData.asesmenSumatif + '</textarea></div>';
} else if(s.id === 'diferensiasi') {
c.innerHTML = '<h2>Diferensiasi</h2><div class="form-group"><label>Konten</label><textarea rows="3" onchange="updateField(\'diferensiasiKonten\',this.value)">' + formData.diferensiasiKonten + '</textarea></div>' +
'<div class="form-group"><label>Proses</label><textarea rows="3" onchange="updateField(\'diferensiasiProses\',this.value)">' + formData.diferensiasiProses + '</textarea></div>' +
'<div class="form-group"><label>Produk</label><textarea rows="3" onchange="updateField(\'diferensiasiProduk\',this.value)">' + formData.diferensiasiProduk + '</textarea></div>';
} else if(s.id === 'media') {
let h = '<h2>P5 & Media</h2><div class="form-group"><label>Dimensi P5</label>';
const dims = ['Beriman bertakwa','Berkebinekaan global','Bergotong royong','Mandiri','Bernalar kritis','Kreatif'];
for(let d of dims) {
const checked = formData.p5Dimensi.indexOf(d) !== -1 ? ' checked' : '';
h += '<label style="display:block;margin:5px 0"><input type="checkbox" value="' + d + '" onchange="toggleP5(\'' + d + '\')"' + checked + '> ' + d + '</label>';
}
h += '</div><div class="form-group"><label>Keterkaitan P5</label><textarea rows="3" onchange="updateField(\'p5Keterkaitan\',this.value)">' + formData.p5Keterkaitan + '</textarea></div><h3>Media</h3>';
for(let i = 0; i < formData.mediaSumber.length; i++) {
h += '<div class="list-item"><input value="' + formData.mediaSumber[i] + '" onchange="updateListItem(\'mediaSumber\',' + i + ',this.value)">';
if(formData.mediaSumber.length > 1) h += '<button class="btn-remove" onclick="removeListItem(\'mediaSumber\',' + i + ')">‚úï</button>';
h += '</div>';
}
h += '<button class="btn-add" onclick="addListItem(\'mediaSumber\')">+ Tambah</button>';
c.innerHTML = h;
}
}

function updateField(f, v) { formData[f] = v; saveToLocalStorage(); }
function updateListItem(f, i, v) { formData[f][i] = v; saveToLocalStorage(); }
function addListItem(f) { formData[f].push(''); renderContent(); }
function removeListItem(f, i) { formData[f].splice(i, 1); renderContent(); }
function toggleP5(d) {
const idx = formData.p5Dimensi.indexOf(d);
if(idx === -1) formData.p5Dimensi.push(d);
else formData.p5Dimensi.splice(idx, 1);
saveToLocalStorage();
}

function nextStep() {
if(currentStep < steps.length - 1) {
currentStep++;
renderSteps();
renderContent();
updateProgress();
window.scrollTo(0, 0);
} else exportModule();
}

function prevStep() {
if(currentStep > 0) {
currentStep--;
renderSteps();
renderContent();
updateProgress();
window.scrollTo(0, 0);
}
}

function goToStep(i) {
currentStep = i;
renderSteps();
renderContent();
updateProgress();
window.scrollTo(0, 0);
}

function updateProgress() {
const p = ((currentStep + 1) / steps.length) * 100;
document.getElementById('progressBar').style.width = p + '%';
document.getElementById('prevBtn').style.display = currentStep === 0 ? 'none' : 'block';
document.getElementById('nextBtn').textContent = currentStep === steps.length - 1 ? 'üéâ Export' : 'Lanjut ‚Üí';
}

function saveToLocalStorage() {
localStorage.setItem('modulAjarDraft', JSON.stringify(formData));
}

function loadFromLocalStorage() {
const s = localStorage.getItem('modulAjarDraft');
if(s) formData = JSON.parse(s);
}

function saveModule() {
if(!formData.mataPelajaran || !formData.kelas) {
alert('‚ö†Ô∏è Lengkapi Mata Pelajaran dan Kelas!');
return;
}
const ms = JSON.parse(localStorage.getItem('savedModules') || '[]');
ms.push({id: Date.now(), data: JSON.parse(JSON.stringify(formData)), timestamp: new Date().toISOString()});
localStorage.setItem('savedModules', JSON.stringify(ms));
alert('‚úÖ Modul disimpan!');
}

function showSaved() {
const ms = JSON.parse(localStorage.getItem('savedModules') || '[]');
let h = '';
if(ms.length === 0) h = '<p style="text-align:center;padding:40px">Belum ada modul</p>';
else {
for(let m of ms.reverse()) {
const d = new Date(m.timestamp);
h += '<div class="saved-item"><h3>' + (m.data.mataPelajaran || 'Tanpa Judul') + ' - Kelas ' + (m.data.kelas || '-') + '</h3>' +
'<p style="color:#6b7280;font-size:.9em">' + d.toLocaleString('id-ID') + '</p>' +
'<button class="btn btn-blue" style="margin-top:10px" onclick="loadSavedModule(' + m.id + ')">üìÇ Muat</button> ' +
'<button class="btn btn-red" style="margin-top:10px" onclick="deleteSavedModule(' + m.id + ')">üóëÔ∏è Hapus</button></div>';
}
}
document.getElementById('savedList').innerHTML = h;
document.getElementById('savedModal').style.display = 'block';
}

function loadSavedModule(id) {
const ms = JSON.parse(localStorage.getItem('savedModules') || '[]');
const m = ms.find(x => x.id === id);
if(m) {
formData = JSON.parse(JSON.stringify(m.data));
currentStep = 0;
renderSteps();
renderContent();
updateProgress();
closeModal();
alert('‚úÖ Modul dimuat!');
}
}

function deleteSavedModule(id) {
if(confirm('Yakin hapus?')) {
let ms = JSON.parse(localStorage.getItem('savedModules') || '[]');
ms = ms.filter(m => m.id !== id);
localStorage.setItem('savedModules', JSON.stringify(ms));
showSaved();
}
}

function closeModal() {
document.getElementById('savedModal').style.display = 'none';
}

function exportModule() {
let txt = '='.repeat(80) + '\nMODUL AJAR KURIKULUM MERDEKA\n' + '='.repeat(80) + '\n\n';
txt += 'Satuan: ' + formData.satuan + '\nMata Pelajaran: ' + formData.mataPelajaran + '\nKelas: ' + formData.kelas + '\n\n';
txt += 'CAPAIAN PEMBELAJARAN\n' + formData.capaianPembelajaran + '\n\n';
txt += 'TUJUAN\n';
for(let i = 0; i < formData.tujuanPembelajaran.length; i++) {
if(formData.tujuanPembelajaran[i]) txt += (i+1) + '. ' + formData.tujuanPembelajaran[i] + '\n';
}
txt += '\n' + '='.repeat(80);
const blob = new Blob([txt], {type: 'text/plain;charset=utf-8'});
const fn = 'Modul_' + (formData.mataPelajaran || 'Untitled').replace(/\s+/g, '_') + '.txt';
saveAs(blob, fn);
alert('üéâ Export berhasil!');
}
</script>
</body>
</html>
